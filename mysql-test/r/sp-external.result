#
# WL#15254: SQL syntax extensions to support external language routines
#
#
# Tests for LANGUAGE clause
#
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE SQL
BEGIN RETURN a-1; END //
DROP FUNCTION foo//
# SQL is default
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC
BEGIN RETURN a-1; END //
DROP FUNCTION foo//
# Currently, no other language than SQL is supported
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE FUNCTION JAVASCRIPT(a INTEGER) RETURNS INTEGER DETERMINISTIC
LANGUAGE JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE PYTHON
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'PYTHON'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE RUBY
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'RUBY'.
# Test lower-case
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE javascript
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'javascript'.
# Test mixed-case
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE jAvaScRIpt
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'jAvaScRIpt'.
# Any valid identifier can be used for language name
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE JAVA1
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVA1'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE $NOLANG
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: '$NOLANG'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC
LANGUAGE $$JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: '$$JAVASCRIPT'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE 123j
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: '123j'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE __
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: '__'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC
LANGUAGE "JAVASCRIPT"
  BEGIN RETURN a-1; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '"JAVASCRIPT"
  BEGIN RETURN a-1; END' at line 2
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC
LANGUAGE 'JAVASCRIPT'
  BEGIN RETURN a-1; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''JAVASCRIPT'
  BEGIN RETURN a-1; END' at line 2
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE " "
  BEGIN RETURN a-1; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '" "
  BEGIN RETURN a-1; END' at line 1
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE J?
BEGIN RETURN a-1; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '?
BEGIN RETURN a-1; END' at line 1
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC
LANGUAGE \JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\JAVASCRIPT
BEGIN RETURN a-1; END' at line 2
# An identifier may not consist solely of digits
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE 123
BEGIN RETURN a-1; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '123
BEGIN RETURN a-1; END' at line 1
# MySQL allows multiple clauses for the same characteristics
# (This is not according to SQL standard). Last one will take effect.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
LANGUAGE JAVASCRIPT DETERMINISTIC LANGUAGE SQL
BEGIN RETURN a-1; END //
DROP FUNCTION foo//
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
LANGUAGE SQL DETERMINISTIC LANGUAGE JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
# Multiple languages in one clause is not allowed
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
LANGUAGE SQL DETERMINISTIC LANGUAGE JAVASCRIPT PYTHON
BEGIN RETURN a-1; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'BEGIN RETURN a-1; END' at line 3
Check "weird" white space before and after JAVASCRIPT.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
LANGUAGE
JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
LANGUAGE	
JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
LANGUAGE	  	 JAVASCRIPT  DETERMINISTIC	
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
LANGUAGE
-- Comment
JAVASCRIPT
-- Comment
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
The language will here be interpreted to be BEGIN
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
DETERMINISTIC LANGUAGE
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'BEGIN'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
LANGUAGE SQL DETERMINISTIC LANGUAGE
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'BEGIN'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
DETERMINISTIC LANGUAGE
BEGIN a-1; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '-1; END' at line 3
#Combinations with other characteristics
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC NO SQL
LANGUAGE JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC NO SQL
LANGUAGE SQL
BEGIN RETURN a-1; END //
DROP FUNCTION foo//
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE SQL NO SQL
BEGIN RETURN a-1; END //
DROP FUNCTION foo//
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE JAVASCRIPT
CONTAINS SQL
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC READS SQL DATA
LANGUAGE JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE JAVASCRIPT
MODIFIES SQL DATA
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE SQL
CONTAINS SQL
BEGIN RETURN a-1; END //
DROP FUNCTION foo//
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC READS SQL DATA
LANGUAGE SQL
BEGIN RETURN a-1; END //
DROP FUNCTION foo//
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER DETERMINISTIC LANGUAGE SQL
MODIFIES SQL DATA
BEGIN RETURN a-1; END //
DROP FUNCTION foo//
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER NOT DETERMINISTIC LANGUAGE SQL
BEGIN RETURN a-1; END //
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER NOT DETERMINISTIC
LANGUAGE JAVASCRIPT
BEGIN RETURN a-1; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
# This is not SQL
CREATE FUNCTION foo(a INTEGER) RETURNS INTEGER
LANGUAGE SQL DETERMINISTIC LANGUAGE SQL
$$ return a-1; $$ //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'return a-1; $$' at line 3
# Repeat test cases for PROCEDURE
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE SQL
BEGIN DECLARE b INTEGER DEFAULT a; END //
DROP PROCEDURE bar//
# SQL is default
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC
BEGIN DECLARE b INTEGER DEFAULT a; END //
DROP PROCEDURE bar//
# Currently, no other language than SQL is supported
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE PROCEDURE JAVASCRIPT(a INTEGER) DETERMINISTIC
LANGUAGE JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE PYTHON
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'PYTHON'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE RUBY
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'RUBY'.
# Test lower-case
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE javascript
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'javascript'.
# Test mixed-case
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE jAvaScRIpt
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'jAvaScRIpt'.
# Any valid identifier can be used for language name
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE JAVA1
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVA1'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE $NOLANG
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: '$NOLANG'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE $$JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: '$$JAVASCRIPT'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE 123j
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: '123j'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE __
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: '__'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE "JAVASCRIPT"
  BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '"JAVASCRIPT"
  BEGIN DECLARE b INTEGER DEFAULT a; END' at line 1
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE 'JAVASCRIPT'
  BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''JAVASCRIPT'
  BEGIN DECLARE b INTEGER DEFAULT a; END' at line 1
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE " "
  BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '" "
  BEGIN DECLARE b INTEGER DEFAULT a; END' at line 1
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE J?
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '?
BEGIN DECLARE b INTEGER DEFAULT a; END' at line 1
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE \JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END' at line 1
# An identifier may not consist solely of digits
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE 123
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '123
BEGIN DECLARE b INTEGER DEFAULT a; END' at line 1
# MySQL allows multiple clauses for the same characteristics
# (This is not according to SQL standard). Last one will take effect.
CREATE PROCEDURE bar(a INTEGER)
LANGUAGE JAVASCRIPT DETERMINISTIC LANGUAGE SQL
BEGIN DECLARE b INTEGER DEFAULT a; END //
DROP PROCEDURE bar//
CREATE PROCEDURE bar(a INTEGER)
LANGUAGE SQL DETERMINISTIC LANGUAGE JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
# Multiple languages in one clause is not allowed
CREATE PROCEDURE bar(a INTEGER)
LANGUAGE SQL DETERMINISTIC LANGUAGE JAVASCRIPT PYTHON
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'BEGIN DECLARE b INTEGER DEFAULT a; END' at line 3
Check "weird" white space before and after JAVASCRIPT.
CREATE PROCEDURE bar(a INTEGER)
LANGUAGE
JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE PROCEDURE bar(a INTEGER)
LANGUAGE	
JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE PROCEDURE bar(a INTEGER)
LANGUAGE	  	 JAVASCRIPT  DETERMINISTIC	
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE PROCEDURE bar(a INTEGER)
LANGUAGE
-- Comment
JAVASCRIPT
-- Comment
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
The language will here be interpreted to be BEGIN
CREATE PROCEDURE bar(a INTEGER)
DETERMINISTIC LANGUAGE
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'DECLARE b INTEGER DEFAULT a; END' at line 3
CREATE PROCEDURE bar(a INTEGER)
LANGUAGE SQL DETERMINISTIC LANGUAGE
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'DECLARE b INTEGER DEFAULT a; END' at line 3
CREATE PROCEDURE bar(a INTEGER)
DETERMINISTIC LANGUAGE
BEGIN a-1; END //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '-1; END' at line 3
#Combinations with other characteristics
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC NO SQL
LANGUAGE JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC NO SQL
LANGUAGE SQL
BEGIN DECLARE b INTEGER DEFAULT a; END //
DROP PROCEDURE bar//
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE SQL NO SQL
BEGIN DECLARE b INTEGER DEFAULT a; END //
DROP PROCEDURE bar//
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE JAVASCRIPT
CONTAINS SQL
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC READS SQL DATA
LANGUAGE JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE JAVASCRIPT
MODIFIES SQL DATA
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE SQL
CONTAINS SQL
BEGIN DECLARE b INTEGER DEFAULT a; END //
DROP PROCEDURE bar//
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC READS SQL DATA
LANGUAGE SQL
BEGIN DECLARE b INTEGER DEFAULT a; END //
DROP PROCEDURE bar//
CREATE PROCEDURE bar(a INTEGER) DETERMINISTIC LANGUAGE SQL
MODIFIES SQL DATA
BEGIN DECLARE b INTEGER DEFAULT a; END //
DROP PROCEDURE bar//
CREATE PROCEDURE bar(a INTEGER) NOT DETERMINISTIC LANGUAGE SQL
BEGIN DECLARE b INTEGER DEFAULT a; END //
CREATE PROCEDURE bar(a INTEGER) NOT DETERMINISTIC LANGUAGE JAVASCRIPT
BEGIN DECLARE b INTEGER DEFAULT a; END //
ERROR HY000: Unsupported external language: 'JAVASCRIPT'.
# This is not SQL
CREATE PROCEDURE bar(a INTEGER)
LANGUAGE SQL DETERMINISTIC LANGUAGE SQL
$$ let b = a; $$ //
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'let b = a; $$' at line 3
# Check ALTER statements
ALTER FUNCTION foo NO SQL //
# When dictionary support is ready, changing language will not be allowed
ALTER FUNCTION foo LANGUAGE SQL NO SQL //
ALTER FUNCTION foo LANGUAGE JAVASCRIPT //
ALTER PROCEDURE bar LANGUAGE JAVASCRIPT //
DROP FUNCTION foo //
DROP PROCEDURE bar //
